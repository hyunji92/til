#메모리 관리

> 메모리 누수는 응용 프로그램에서 크래시를 초래할 뿐만 아니라 성능 저하, 응용프로그램의 실행에 해로울 수 있다.

###6.1 가비지 컬렉션
> 달빅 vm은 메모리가 너무 커질 때, 힙이라는 공유 메모리로부터 가비지 컬렉터로 할당된 메모리를 주기적으로 회수하는 메모리 관리
시스템이다. 각 프로세스 == 응용 프로그램은 자신만의 vm과 가비지 컬렉터를 가진다.

- 메모리 누수
    - 메모리를 너무 오랜 시간 할당하고 해제하지 않는 경우 
    - 더는 사용되지 않는데도 GC가 회수 할 수 없는 응용프로그램에 의해 할당된 메모리)
    

응용프로그램은 지속해서 생명주기 동안 새로운 객체를 생성하고, 객체는 인스턴스 변수로 할당되든 지역변수로 할당되든 
번위와 관계없는 힙에 만들어진다.
객체가 더 이상 사용되지 않을 때, GC는 새로운 할당을 위한 메모리를 확보하기 위해 힙에서 객체를 제거한다.

- 객체가 ``도달가능하면`` 객체는 언제는 사용될 수 있고 가비지 컬렉션 대상에서 제외되는 것으로 간주.
- 객체가 ``도달할 수 없으면`` GC는 객체를 마무리하고 메모리를 회수할 수 있다.

달빅 GC는 마크와 스윕이라는 매우 일반적인 두 단계 메커니즘을 사용한다.
마크(mark) -  마크는 객체 트리를 탐색하고 다른 객체에 의해 참조되지 않은 모든 미사용 객체를 표시한다.
스윕(sweep) - 스윕 단계에서 GC의 대상이된 사용하지 않은 객체들의 할당이 해제된다.


###6.2 스레드 관련 메모리 누수
>응용프로그렘 스레드는 실행 중에 가비지 컬렉터가 메모리를 회수하는 것을 방행할 수 있으므로 메모리 누수를 일으킬 잠재적 위험을 가지고있다.
>스ㄹㅔ드가 자신의 객체가 힘에서 해제될 수 있는 실행을 완료했을때만 이런 상황이 된다.

3절에서도 봤듯이 
응용프로그램스레드는 
1. UI 스레드
2. 바인더 스레드
3. 작업자 스레드

바이더스레드와 작업자스레드는 응용프로그램실행 중에 시작되고 종료될 수 있다. 결과적으로 이들은 종료 시 객체 참조를 해제하므로, 객체들이 다른 GC루트에서 도달할 수 없을경우 그객체들을 ``도달할 수 없는 것 `` 즉, GC는 객체를 마무리하고 메모리를 회수할 수 있다.

- 잠재적위험
메모리 누수의 위험은 스레드가 살아 있고 객체 참조를 유지하는 시간과 함께 증가한다. 

- 누수 크기
비트맵, 뷰 계층 구조 등과 같이 누수의 크기가 크면, 적은 수의 누수도 응용프로그램의 힙을 고갈 시키기에 충분할 수 있다.

####6.2.1 스레드 실행

작업자 스레드 실행의 생명주기
1. 스레드 객체를 생성한다. - Thread 객체가 인스턴스화된다.
2. 스레드 실행을 시작한다 - 스레드가 시작되고 Runable인스턴스가 실행된다.
3. 스레드가 종료된다. - Runable 인스턴스가 실행을 종료한다.

객체를 다른메서드에서 참조할 수 있도록 메서드가 자신의 호출자에 객체를 반환하지 않으면,
메서드 안에서 생성된 객체는 메서드가 결과를 반환하는 시점에 가비지 걸렉션의 대상이 된다.



